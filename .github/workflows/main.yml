name: CI
on:
  push:
    # branches:
    #   - main
jobs:
  deploy:
    runs-on: ubuntu-20.04
    steps:
      - name: Git checkout
        uses: actions/checkout@v2

      - name: Install tensorflow.js
        run: 
          pip install tensorflowjs

      - name: Convert models to tfjs
        run: ls models | xargs -I"{}" tensorflowjs_converter --input_format=tf_saved_model --output_node_names='parkour_walker' --saved_model_tags=serve --skip_op_check models/{}/tf1_save web_demo/models/{}

      - name: Generate the list of models
        run:
          echo $(ls models) | tr ' ' , > web_demo/models.csv

      - name: Rename into index.html
        run: mv ./web_demo/demo.html ./web_demo/index.html

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./web_demo
